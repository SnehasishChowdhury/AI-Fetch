<!DOCTYPE html>
<html>
<head>
  <title>AI Lead Finder</title>
</head>

<body>

  <h2>Enter Lead</h2>

  <input id="lead" placeholder="Company or Person Name">
  <button onclick="fetchLead()">Fetch Info</button>

  <h3>Lead Details</h3>
  <pre id="result"></pre>

  <script>
    async function fetchLead(fromURL = false) {
      const leadInput = document.getElementById("lead");
      const lead = leadInput.value.trim();

      if (!lead) return;

      // ✅ Update URL only when user clicks
      if (!fromURL) {
        const params = new URLSearchParams({ lead });
        window.history.pushState({}, "", "?" + params.toString());
      }

      document.getElementById("result").innerText = "Fetching info...";

      try {
        const response = await fetch("/lead", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ lead })
        });

        const data = await response.json();
        document.getElementById("result").innerText = data.info;
      } catch (err) {
        document.getElementById("result").innerText = "Error fetching data.";
      }
    }

    // ✅ Auto-fetch if URL contains ?lead=
    window.onload = () => {
      const leadFromURL = new URLSearchParams(window.location.search).get("lead");
      if (leadFromURL) {
        document.getElementById("lead").value = leadFromURL;
        fetchLead(true);
      }
    };
  </script>

</body>
</html>
